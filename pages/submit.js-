import { useState } from 'react';
import { supabase } from '../lib/supabaseClient';

export default function Submit() {
  const [form, setForm] = useState({ title: '', description: '', file: null });

  const handleSubmit = async (e) => {
    e.preventDefault();

    if (!form.file) return alert('Please upload a file.');
    const { data, error } = await supabase
      .storage
      .from('dapps')
      .upload(`${Date.now()}_${form.file.name}`, form.file);

    if (error) return alert(error.message);

    await supabase.from('dapps').insert({
      title: form.title,
      description: form.description,
      file_url: data.path,
      approved: false
    });

    alert('Submitted! Awaiting review.');
  };

  return (
    <form onSubmit={handleSubmit} className="p-4">
      <h1 className="text-2xl font-bold mb-4">Submit a dApp</h1>
      <p className="text-sm text-gray-700 mb-2">
        ğŸŒŸ Keep it friendly! This platform is for all ages.<br/>
        â— No violence, adult/mature content, or harmful material allowed.
      </p>
      <input onChange={e => setForm({ ...form, title: e.target.value })} placeholder="App Title" className="block p-2 mb-3 border w-full" />
      <textarea onChange={e => setForm({ ...form, description: e.target.value })} placeholder="Short Description" className="block p-2 mb-3 border w-full" />
      <input type="file" onChange={e => setForm({ ...form, file: e.target.files[0] })} className="mb-4" />
      <button className="bg-green-600 text-white p-2 rounded">Submit App</button>
    </form>
  );
}